<!DOCTYPE html>
<html>
  <head>
    <title>Mesh</title>
    <link rel="icon" href="../assets/sphere.ico" />
    <script src="../../../lib/gl-matrix-3.3.0.min.js"></script>
    <script type="module">
      import { WebGL } from "../scripts/webgl.js";
      import { Mesh, Transform } from "../scripts/mesh.js";
      import { Cube, Cylinder, Sphere } from "../scripts/geometry.js";
      import { CameraControl } from "../scripts/camera.js";

      const wgl = await new WebGL("#main").init();
      wgl.setUseTexture(1);
      const camera = new CameraControl([0, 0, 10]);

      const cube = new Cube(1).setupBuffers(wgl);
      const cylinder = new Cylinder().setupBuffers(wgl);
      const sphere = new Sphere().setupBuffers(wgl);

      const getScene = (t) =>
        new Mesh(["root"], null, [
          new Mesh(["center", cube], [Transform.scale([0.1, 0.5, 0.1])]),
          new Mesh(
            ["floor", cube, [0.5, 0.8, 0.5]],
            [Transform.scale([10, 0.1, 10]), Transform.translate([0, -0.3, 0])]
          ),
          new Mesh(
            ["rotating arm"],
            [Transform.rotate([t, [0, 1, 0]])],
            [
              new Mesh(
                ["arm", cylinder, [0.5, 0.5, 0.6]],
                [
                  Transform.scale([0.1, 0.1, 5]),
                  Transform.translate([0, 0, -2.5]),
                ]
              ),
              new Mesh(
                ["ball", sphere, [0.3, 0.3, 0.3]],
                [
                  Transform.scale([0.25, 0.25, 0.1]),
                  Transform.translate([0, 0, -4.5]),
                ]
              ),
            ]
          ),
        ]);

      const drawScene = (t) => {
        getScene(t / 1000).draw(wgl);
        //cube.draw(wgl);
      };

      const tick = (t) => {
        requestAnimationFrame(tick);
        camera.update(wgl);
        drawScene(t);
      };
      tick();
    </script>
  </head>
  <body>
    <canvas id="main" width="1000" height="500">
      Your browser does not support the HTML5 canvas element.
    </canvas>
  </body>
</html>
